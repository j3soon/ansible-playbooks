- name: Set locale to en_US (Ubuntu 22.04)
  # Reference: https://askubuntu.com/a/754355
  # The file content follows the default locale file in a Ubuntu 22.04 fresh install
  become: true
  copy:
    dest: /etc/default/locale
    content: |
      # File generated by update-locale
      LANG="en_US.UTF-8"
      LC_NUMERIC="en_US.UTF-8"
      LC_TIME="en_US.UTF-8"
      LC_MONETARY="en_US.UTF-8"
      LC_PAPER="en_US.UTF-8"
      LC_NAME="en_US.UTF-8"
      LC_ADDRESS="en_US.UTF-8"
      LC_TELEPHONE="en_US.UTF-8"
      LC_MEASUREMENT="en_US.UTF-8"
      LC_IDENTIFICATION="en_US.UTF-8"
    owner: root
    group: root
    mode: '0644'
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_version is version('22.04', '==')
  register: set_locale_22

- name: Set locale to en_US (Ubuntu 24.04)
  # The file content follows the default locale file in a Ubuntu 24.04 fresh install
  become: true
  copy:
    dest: /etc/locale.conf
    content: |
      LANG=en_US.UTF-8
    owner: root
    group: root
    mode: '0644'
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_version is version('24.04', '==')
  register: set_locale_24

- name: Require reboot
  become: true
  copy:
    content: ""
    dest: /var/run/reboot-required
    force: false
    owner: root
    group: root
    mode: '0644'
  when: (set_locale_22 is defined and set_locale_22.changed) or (set_locale_24 is defined and set_locale_24.changed)
